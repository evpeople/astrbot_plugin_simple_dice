# astrbot_plugin_simple_dice

AstrBot 简单骰子插件，支持各种骰子投掷、表达式计算和 KV 键值存储。

## 功能

### 指令投骰
- `/r` - 投掷骰子

### 支持的表达式
| 示例 | 说明 |
|------|------|
| `/r` | 默认 1d20 |
| `/r 2d6` | 投掷 2 个六面骰 |
| `/r d100` | 投掷百分骰 (0-100) |
| `/r 3d10+5` | 3d10 + 5 |
| `/r 2d6-1d4+3` | 混合运算 |
| `/r (2d6+5)*2` | 支持括号 |
| `/r 1d20+str` | 支持 +key 后缀，读取 KV 值作为修正值 |

### KV 存储

插件提供键值存储功能，支持用户和群组级别的数据持久化。

#### 指令 `/kv` 用法

| 指令 | 说明 |
|------|------|
| `/kv get <键名>` | 读取指定键的值 |
| `/kv set <键名> <值>` | 设置单个键值对 |
| `/kv set <属性值对>` | 批量设置，如 `生命30 经验20` |
| `/kv list [前缀]` | 列出所有数据，可选按前缀过滤 |
| `/kv del <键名>` | 删除指定键 |

#### 批量设置示例
```
/kv set 生命30 经验20 力量15
```
设置 `生命=30`, `经验=20`, `力量=15`

#### 前缀搜索示例
```
/kv list 力量
```
列出所有以 "力量" 开头的键值对

### LLM 工具

LLM 可自动调用以下工具：

| 工具名 | 说明 |
|--------|------|
| `roll_dice` | 投掷骰子，支持各种表达式 |
| `kv_read` | 读取指定键的值 |
| `kv_upsert` | 写入或更新键值对 |
| `kv_list` | 列出所有键值对，支持前缀过滤 |

#### roll_dice 工具参数
- `expression`: 骰子表达式，如 "1d20"、"2d6"、"3d10+5"
- `hidden`: 是否暗投，默认为 False

#### kv_read 工具参数
- `key`: 要读取的键名
- `scope`: 作用域，"user" 或 "group"

#### kv_upsert 工具参数
- `key`: 键名（单个键值模式）
- `value`: 值（支持数字、字符串、列表、字典）
- `multi`: 一行字符串更新多个属性，如 "生命30经验20"
- `scope`: 作用域，"user" 或 "group"

#### kv_list 工具参数
- `scope`: 作用域，"user" 或 "group"
- `prefix`: 可选，键名前缀，仅返回匹配前缀的键值对

## 安装

将插件放置于 AstrBot 的 `data/plugins` 目录下，重启 AstrBot 即可。

## License

MIT
